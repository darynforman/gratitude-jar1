{{define "edit-form"}}
<div id="edit-form-{{.ID}}" class="glass rounded-2xl p-8 mt-6 shadow-xl relative overflow-hidden animate-slide-up">
    <!-- Decorative Elements -->
    <div class="absolute -top-20 -right-20 w-40 h-40 bg-gradient-to-br from-[#EC4899]/20 to-[#D91656]/20 rounded-full blur-3xl"></div>
    <div class="absolute -bottom-20 -left-20 w-40 h-40 bg-gradient-to-tr from-[#EC4899]/20 to-[#D91656]/20 rounded-full blur-3xl"></div>

    <div class="flex items-center justify-between mb-8 relative">
        <h2 class="text-2xl font-bold text-[#EC4899]">Edit Gratitude Note</h2>
        <button type="button" 
                onclick="document.getElementById('edit-form-{{.ID}}').remove()"
                class="p-2 text-gray-500 hover:text-[#D91656] hover:bg-[#D91656]/5 rounded-xl transition-all duration-200">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
        </button>
    </div>
    
    <form hx-put="/gratitude/update/{{.ID}}"
          hx-target="#note-{{.ID}}"
          hx-swap="outerHTML"
          hx-on::before-request="console.log('Starting update request for note:', {{.ID}})"
          hx-on::after-request="console.log('Update request completed'); document.getElementById('edit-form-{{.ID}}').remove()"
          hx-on::error="console.error('Error updating note:', event.detail)"
          hx-headers='{"Content-Type": "application/x-www-form-urlencoded"}'
          class="space-y-6 relative">
        
        <input type="hidden" name="id" value="{{.ID}}">
        
        <div class="group">
            <label for="title-{{.ID}}" class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-[#EC4899] transition-colors">Title</label>
            <input type="text" id="title-{{.ID}}" name="title" value="{{.Title}}" required
                   class="block w-full rounded-xl border-gray-200 shadow-sm focus:border-[#EC4899] focus:ring-[#EC4899] transition-all duration-200 text-lg py-3 px-4 bg-white/50">
        </div>
        
        <div class="group">
            <label for="content-{{.ID}}" class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-[#EC4899] transition-colors">Content</label>
            <textarea id="content-{{.ID}}" name="content" rows="4" required
                      class="block w-full rounded-xl border-gray-200 shadow-sm focus:border-[#EC4899] focus:ring-[#EC4899] transition-all duration-200 text-lg py-3 px-4 bg-white/50">{{.Content}}</textarea>
        </div>

        <div>
            <label class="block text-sm font-medium text-gray-700 mb-4">Choose an Emoji</label>
            <div class="flex flex-wrap gap-4 p-4 bg-white/50 rounded-2xl">
                <button type="button" 
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "âœ¨"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="âœ¨"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    âœ¨
                </button>
                <button type="button"
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "ğŸŒŸ"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="ğŸŒŸ"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ğŸŒŸ
                </button>
                <button type="button"
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "ğŸ’«"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="ğŸ’«"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ğŸ’«
                </button>
                <button type="button"
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "ğŸ™"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="ğŸ™"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ğŸ™
                </button>
                <button type="button"
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "â¤ï¸"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="â¤ï¸"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    â¤ï¸
                </button>
                <button type="button"
                        class="emoji-btn text-4xl p-4 rounded-xl hover:scale-110 hover:bg-white hover:shadow-xl transition-all duration-300 {{if eq .Emoji "ğŸŒˆ"}}scale-110 bg-white shadow-xl{{end}}"
                        data-emoji="ğŸŒˆ"
                        onclick="selectEmoji(this, 'edit-selected-emoji')">
                    ğŸŒˆ
                </button>
            </div>
            <input type="hidden" name="emoji" id="edit-selected-emoji" value="{{.Emoji}}" required>
        </div>
        
        <div class="group">
            <label for="category-{{.ID}}" class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-[#EC4899] transition-colors">Category</label>
            <select id="category-{{.ID}}" name="category" required
                    class="block w-full rounded-xl border-gray-200 shadow-sm focus:border-[#EC4899] focus:ring-[#EC4899] transition-all duration-200 text-lg py-3 px-4 bg-white/50">
                <option value="personal" {{if eq .Category "personal"}}selected{{end}}>âœ¨ Personal Growth</option>
                <option value="work" {{if eq .Category "work"}}selected{{end}}>ğŸ’¼ Professional Life</option>
                <option value="family" {{if eq .Category "family"}}selected{{end}}>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family & Friends</option>
                <option value="achievements" {{if eq .Category "achievements"}}selected{{end}}>ğŸ† Achievements</option>
                <option value="health" {{if eq .Category "health"}}selected{{end}}>ğŸŒ± Health & Wellness</option>
                <option value="experiences" {{if eq .Category "experiences"}}selected{{end}}>ğŸŒŸ Experiences</option>
            </select>
        </div>
        
        <div class="flex justify-end space-x-4">
            <button type="button"
                    onclick="document.getElementById('edit-form-{{.ID}}').remove()"
                    class="px-6 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-all duration-200">
                Cancel
            </button>
            <button type="submit"
                    class="px-6 py-2.5 text-sm font-medium text-white bg-gradient-to-r from-[#EC4899] to-[#D91656] rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200">
                Save Changes
            </button>
        </div>
    </form>
</div>

<script>
function selectEmoji(button, inputId) {
    // Remove active state from all emoji buttons in the same container
    button.parentElement.querySelectorAll('.emoji-btn').forEach(btn => {
        btn.classList.remove('scale-110', 'bg-white', 'shadow-xl');
    });
    
    // Add active state to selected emoji button
    button.classList.add('scale-110', 'bg-white', 'shadow-xl');
    
    // Update hidden input with selected emoji
    document.getElementById(inputId).value = button.getAttribute('data-emoji');
}
</script>

<style>
@keyframes slide-up {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.animate-slide-up {
    animation: slide-up 0.8s ease-out forwards;
}
</style>
{{end}} 